# DB01

## Database

데이터베이스 -> models.py 와 소통해

체계화된 데이터의 모임

몇 개의 자료 파일을 조직적으로 통합하여 자료 항목의 중복을  없애고 자료를 구조화하여 기억시켜 놓은 자료의 집합체

-> 데이터와 자료가 조직적으로 구조화 되어있음, 집합체



### 데이터 베이스로 얻는 장점들 

-> 아 이런 장점이 있구나 정도!

데이터 중복 최소화

데이터 무결성(정확한 정보를 보장) -> 정보가 부정확하면 데이터 베이스를 사용하는 이유가 없어져..  

데이터 일관성

데이터 독립성

데이터 표준화

데이터 보안 유지 등등..



## RDB

관계형 데이터베이스(Relational Database)

키(key)와 값(value)의 관계(relation)를 표(table) 형태로 정리한 데이터베이스 ex.엑셀

데이터베이스에서는 표를 관계라고 하기도 함 또는 relation 



스키마(schema): 데이터베이스에서 자료의 구조, 표현방법, 관계등 전반적인 명세를 기술한 것 -> 명세서!!

테이블(table): 열과 행의 모델을 사용해 조직된 데이터 요소들의 집합, 명세를 기준으로 테이블이 형성

네개의 컬럼이 정의되고 실제로 네개의 컬럼과 그에 상응하는 데이터 타입이 결정이 되고  있음

사진



열: 컬럼/필드

각 열에는 고유한 데이터 형식이 지정됨

name이란 필드에 고객의 이름(TEXT) 정보가 저장됨



행: 로우/레코드/값  

실제 데이터가 저장되는 형태

실제로 행 한 줄이 데이터 하나!

총 3명의 고객정보가 저장되어 있음(= 레코드가 3개!)



기본키(Primary Key): 각 행이 가지는 고유한 값

장고에서 각각의 모델 테이블에 접근하기위해  가장 많이 사용하는 것이 pk!

반드시 데이터 베이스에서 설정을 해야함

고유한 값의 역할도 하지만, 다른 데이터와의 관계 설정에서도 중요함



## RDBMS

Relational Database Management System

관계형 데이터베이스 관리 시스템

ex. MySQL, SQLite, PostgreSQL, ORACLE, MS SQL

우리는 SQLite 이용할거야!



### SQLite

서버 형태가 아닌 파일 형식으로 응용 프로그램에 넣어서 사용하는 비교적 가벼운 데이터베이스

파일 형태로 구성되어 있어 관리하기 간편하고 가벼워서 로컬에서 간단한 DB 구성이 가능함, 오픈소스 프로젝트로 자유롭게 사용 가능함



### Sqlite Data Type 

1. Null 

   값이 없음을 표현하는 null 값, 데이터 없어 파이썬에서는 None

2. INTERTER 정수

   0부터 8바이트에 저장된 부호 있는 정수

3. REAL 소수

   부동 소수점 값

4. TEXT 

   문자열 값

5. BLOB 

   바이너리 데이터 -> 타입 없이 그대로 저장되는것



### Sqlite Type Affinity  

Sqlite의 독특한 특징은 선호도가 있음!

Sqlite는 동적인 데이터 타입을 가지고 있음  일반적인 데이터 시스템은 정적 데이터를 선호함 

정적 데이터 타입이란? 실제로 타입을 저장했을 때 그 타입으로만 저장됨

하지만 Sqlite는 우리가 타입을 지정하지 않거나 여러가지의  INTERGER타입으로 저장해도 타입 선호도에 따라 자동으로 변경이 됨



Type Affinity 특정 컬럼에 저장하도록 권장하는 데이터 타입

1. INTERGER
2. TEXT
3. BLOB
4. REAL
5. NUMERIC



테이블을 만들거나 테이블에 컬럼의 데이터 타입을 정의를 할 때, 

같은 정수라도 많은 이름의 정수 타입이 존재함 하지만 결과적인 선호도는 INTERGER로 통합

위의 4개의 데이터 타입에 만족하지 않으면  NUMERIC

사진



그냥 처음부터 선호도에 맞춰서 데이터 타입을 지정해주자~.~



## SQL 

Structured Query Language

관계형 데이터베이스 관리시스템(SQLite, MYSQL 등..)의 데이터 관리를 위해 설계된 특수 목적의 프로그래밍 언어

이 언어를 통해서!

데이터베이스 스키마 생성, 수정

자료의 검색, 관리

데이터베이스 객체 접근 조정 관리

즉, RDBMS에서 사용하는 프로그래밍 언어 SQL



### SQL 분류

- DDL (Data Definition Language) 데이터 정의 언어

  데이터베이스 구조(테이블, 스키마)를 정의하기 위한 명령어

  CREATE, DROP, ALTER

- DML (Data Manipulation Language) 데이터 조작 언어(중요해!)

   데이터를 저장,조회,수정,삭제 등을 위한 명령어 -> CRUD

  INSERT, SELECT, UPDATE, DELETE

- DCL (Data Control Language) 데이터 제어 언어

  데이터베이스 사용자의 권한 제어를 위해 사용하는 명령어



-> 데이터를 어떻게 정의하고 조작할지에 초점을 두고 공부하자!



### DML

INSERT : 새로운 데이터 삽입(추가)

SELECT :  저장되어있는 데이터 조회

UPDATE : 저장되어있는 데이터 갱신

DELETE :  저장되어있는 데이터 삭제



## 테이블 생성 및 삭제

데이터베이스 생성하기

sqlite3 tutorial.sqlite3

sqlite shell이 오픈이 됨

.database  tutorial.sqlite3라는 데이터베이스가 생김

장고에서는 db.sqlite3

. 은 SQL은 아님 프로그램 즉 shell에 대한 기능을 실행하는 것!!



데이터가 입력이 되려면 테이블이 있어야함 우리가 준비된 csv를 import하기 위해서는 mode를 활성화 시켜야함

.mode csv 아무런 변화는 없음

. import hellodb.csv examples 

현재 위치에 있는  csv중에 hellodb를 어떠한 테이블에 import 할것인가 테이블 이름을 examples로 사용

이렇게 입력해도 아무런 변화가 없음

.tables 현재있는 테이블 목록을 확인하면 examples가 등장함!



shell에서 입력하는게 어렵기도하고 불편해서 SQLite라는 확장 프로그램을 사용함

tutorial.sqlite3 마우스 우측버튼을 누르고 open database를 누르면 아래쪽에 SQLITE EXPLORER가 활성화 됨

열어보면 테이블이 있음



조회 

SELECT * FROM examples(테이블 이름);

examples라는 테이블에서 전체를 선택



.headers on

위에 헤더가 등장한



.mode column

선이 나와서 구분됨



shell은 불편해! 확장프로그램 사용하기



Run Query 작성된 모든 SQL문을 실행

Run Selected Query 블록을 잡았거나 커서가 있는 것만 실행

그럼 오른쪽에 결과가 출력됨

오오.. shell 보다 훨씬 편하다!



이번에는 다른 테이블을 만들어 보자!

두개의 컬럼읠 지정

데이터를 넣는게 아니라 스키마를 지정 

세미콜론 까먹지마!

이런 데이터 타입과 컬럼을 가진 테이블을 만들거야! 테이블의 이름은 classmates

run query를 해도 테이블만 만들었기 때문에 아무내용이 나오지 않음

스키마를 확인해보면 우리가 만든 id와  name이 나옴



sql문은 전부 대문자 형태 소문자로 해도 동작은 하지만 대문자를 사용하자!

테이블 생성 및 삭제

테이블 생성 CREATE TABLE

테이블 삭제 DROP TABLE



.schema classmates

이 테이블의 스키마를 확인할래



DROP TABLE classmates;

이 테이블 지울래





## CRUD

### CREATE

- INSERT

  "insert a single row into a table" -> 하나의 테이블에 한 줄의 데이터를 넣겠다!

  테이블에 단일 행 삽입



실습하기



주소는 안넣어서 address에 NULL이 들어감

모든열에 대한 데이터를 넣는다면 굳이 column 을 명시해 줄 필요가 없음

shell에서 확인하는게 아니기때문에 SELECT * FROM classmates; 해 줄 필요 없음



여기서 2가지 의문점!

1. id는 어디로 간거야??

   우리가 명시를 하지 않았을 때 Primary KEY 역할을 하는 id가 별도로 존재를 하게 됨

   기본적으로 출력이 되지않아 id를 출력하고 싶다면 별도로 rowid를 포함시켜서 조회 해줘야 함

2. 홍길동의 주소에 데이터가 비어있어도 될까?

   아니!! 주소가 꼭 필요한 정보라면 처음에 스키마를 지정할 때 타입 뒤에 NOT NULL 이라는 속성 값을 넣어줘야 함

   데이터베이스는 기본적으로 빈 값을 허용하지 않음..빈 문자열이라도 들어가야함!



얘 지우고 다시 만들자ㅠㅠ

PK의 속성을 쓰기 위해서 이렇게 써줌

기본적으로 사용하던 rowid가 우리가 작성해 준 id (PRIMARY KEY) 로 대체됨

age에 INT라고 써도 상관없음 어차피 동적 데이터라 만들어지면 INTERGER로 통합됨

주의할점!!! 프라이머리키는 반드시 interger라고 입력해야함 다른 정수형 데이터는 int라고 적어도 상관없음

프라이머리키는 INTEGER에서만 적용됨



다시 insert 사용해보기

지금 column이 4개가 있는데 주어진 값이 3개야! 라는 에러 메세지가 나옴

rowid가 아닌 id로 PK값을 직접 지정해줬기 때문에 스키마에 이 column 값을 명시하지 않으면 자동으로 입력되지 않음

그럼 어떻게 해야해??

1. id를 포함한 모든 value 작성 ->  근데 이거 좀 귀찮아 직전의 id도 알아야하잖아
2. id를 제외한 나머지 column의 이름들과  그에 맞는 value를 작성해줌



그치만 귀찮으니까 이번 실습에서는 rowid를 사용해서 편하게 진행하자! ㅎㅎ

테이블 지우고 다시 만들어~~



한번에 여러개의 데이터를 넣을때는 values를 늘려줘



## READ

조회가 데이터베이스에서 가장 중요!

- SELECT

  테이블에서 데이터를 조회

  다양한 절(clause) 과 함께 사용



### SELECT 와 함께 사용하는 clause

- LIMIT

  쿼리에서 반환하는 행 수를 제한 -> 조회를 할 때 10개만 가져와! 3개만 가져와!

  특정 행부터 시작해서 조회하기 위해 OFFSET 키워드와 함께 사용함(OFFSET은 0부터 시작한다고 생각하면 편해!)

  ex. 1 2 3 4 5 6 이라는 데이터가 있을 때 4개만 조회하는데 3, 4, 5, 6만 조회하고 싶으면 LIMIT4 OFFSET2

  시작점에서 2개의 차이 이후부터 시작을 하겠다!

- WHERE

  if 같은 조건을 거는 것, 쿼리에서 반환된 행에 대한 특정 검색 조건을 지정함

- SELECT DISTINCT

  조회 결과에서 중복 행을 제거함

  SELECT 키워드 바로 뒤에 작성해야함



어떤 테이블에서 이러한 컬럼을 조회할거야

*는 모든 컬럼 조회를 의미함



우리는 지금 rowid를 쓰고있으니까 rowid



@ DISTINCT의 특징은 SELECT의 바로 뒤에 나와야해!

\~~정리~~

이터 삽입은 INSERT INTO

테이블 생성은 CREATE

테이블 삭제는 DROP

데이터 조회는 SELECT

소문자로 써도 되지만 sql문의 구조를 확인하기 위해서 대문자로 쓰는게 좋음! 

실제로 소문자로 쓴다고해서 기능적 영향은 주지않아~~

rowid는 우리가 primary key라고하는 속성을 가진 별도의 컬럼을 명시하지않으면 자동으로 지정됨 만약에 얘를 쓰고 싶지 않다면, 스키마에서  primary key라는 속성을 가진 다른 컬럼 값을 정의해줘야함

rowid에는 최대값이 있을까..? 64비트 기준으로 하나의 테이블이 가질 수 있는 최댓값은 900경..? 뭐래...??



## DELETE

테이블에서 행을 제거

조건을 통해 특정 레코드 삭제!

구문이 약간 달라짐

~테이블에서 ~(조건)을 지우겠다!









group by 

조건이 나오고 그룹을 지어야함